/*
 便捷功能
 04260000    下等怪物结晶C                                      31级到50级之间怪物的战利品聚集而成的结晶。                                                                                                           N  
 04260001    下等怪物结晶B                                      51级到60级之间怪物的战利品聚集而成的结晶。                                                                                                           N  
 04260002    下等怪物结晶A                                      61级到70级之间怪物的战利品聚集而成的结晶。                                                                                                           N  
 04260003    中等怪物结晶C                                      71级到80级之间怪物的战利品聚集而成的结晶。                                                                                                           N  
 04260004    中等怪物结晶B                                      81级到90级之间怪物的战利品聚集而成的结晶。                                                                                                           N  
 04260005    中等怪物结晶A                                      91级到100级之间怪物的战利品聚集而成的结晶。                                                                                                          N  
 04260006    高等怪物结晶C                                      101级到110级之间怪物的战利品聚集而成的结晶。                                                                                                         N  
 04260007    高等怪物结晶B                                      111级到120级之间怪物的战利品聚集而成的结晶。                                                                                                         N  
 04260008    高等怪物结晶A                                      121级以上怪物的战利品聚集而成的结晶。                    
 
 04007000    魔法粉末(褐色)                                     发出褐色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007001    魔法粉末(白色)                                     发出白色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007002    魔法粉末(蓝色)                                     发出蓝色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007003    魔法粉末(绿色)                                     发出绿色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007004    魔法粉末(黄色)                                     发出黄色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007005    魔法粉末(紫色)                                     发出紫色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007006    魔法粉末(红色)                                     发出红色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 04007007    魔法粉末(黑色)                                     发出黑色光泽的魔法粉末。可以用来制作装备。                                                                                                             N  
 
 04130000    手套制作辅助剂                                      制作手套时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                 N  
 04130001    鞋子制作辅助剂                                      制作鞋子时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                 N  
 04130002    单手剑制作辅助剂                                     制作单手剑时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                           N  
 04130003    单手斧制作辅助剂                                     制作单手斧时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                            N  
 04130004    单手钝器制作辅助剂                                   作单手钝器时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                         N  
 04130005    双手剑制作辅助剂                                     制作双手剑时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                       N  
 04130006    双手斧制作辅助剂                                     制作双手斧时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                         N  
 04130007    双手钝器制作辅助剂                    制作双手钝器时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                               N  
 04130008    枪制作辅助剂                                       制作枪时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                  N  
 04130009    矛制作辅助剂                                       制作矛时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                  N  
 04130010    短杖制作辅助剂                                      制作短杖时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                 N  
 04130011    长杖制作辅助剂                                      制作长杖时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                 N  
 04130012    弓制作辅助剂                                       制作弓时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                  N  
 04130013    弩制作辅助剂                                       制作弩时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                  N  
 04130014    短剑制作辅助剂                                      制作短剑时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                 N  
 04130015    拳套制作辅助剂                                      制作拳套时一起使用的话，道具属性可能变化。但是10%的比率会失败。                                                                                                 N  
 04130016    拳甲制作促进剂                                      和拳甲一起使用时可以改变道具的效果。只是也有10%的可能会制作失败。                                                                                        N  
 04130017    短枪制作促进剂                                      和短枪一起使用时可以改变道具的效果。只是也有10%的可能会制作失败。                                                                                           N  
 04130018    头盔制作促进剂                 制作头盔的时候一起使用的话道具属性会有变化。但10%的几率道具制作会失败。                                                                                     N  
 04130019    上衣制作促进剂              制作上衣的时候一起使用的话道具属性会有变化。但10%的几率道具制作会失败。                                                                                             N  
 04130020    裤裙制作促进剂                                      作裤裙的时候一起使用的话道具属性会有变化。但10%的几率道具制作会失败。                                                                                        N  
 04130021    全身铠甲制作促进剂                          制作全身铠甲的时候一起使用的话道具属性会有变化。但10%的几率道具制作会失败。                                                                                           N  
 04130022    盾牌制作促进剂                                      制作头盔的时候一起使用的话道具属性会有变化。但10%的几率道具制作会失败。
 */
var crystal= [4260000,4260001,4260002,4260003,4260004,4260005,4260006,4260007,4260008];
var Magicpowder=[4007000,4007001,4007002,4007003,4007004,4007005,4007006,4007007];

var ore_1= [4010000,
4010001,
4010002,
4010003,
4010004,
4010005,
4010006,
4020000,
4020001,
4020002,
4020003,
4020004,
4020005,
4020006,
4020007,
4020008];/*青铜母矿 
 钢铁母矿 
 锂矿石母矿 
 朱矿石母矿 
 银的母矿 
 紫矿石母矿 
 黄金母矿 
 石榴石母矿 
 紫水晶母矿 
 海蓝石母矿 
 祖母绿母矿 
 蛋白石母矿 
 蓝宝石母矿 
 黄晶母矿 
 钻石母矿 
 黑水晶母矿*/
var ore_2= [4004000,
4004001,
4004002,
4004003,
4004004,
4005000,
4005001,
4005002,
4005003,
4005004]
/*
 力量母矿 
 智慧母矿 
 敏捷母矿 
 幸运母矿 
 黑暗水晶母矿 
 力量水晶 
 智慧水晶 
 敏捷水晶 
 幸运水晶 
 黑暗水晶  
*/
//itemid分类
			/*
			id / 10000 == 100;//cap
			id / 10000 == 101
			id / 10000 == 102
			id / 10000 > 110;//weapen
			id / 10000 == 104;//coat
			id / 10000 == 105;//long coat
			id / 10000 == 106;//pants
			id / 10000 == 107;//shoes
			id / 10000 == 108;//glove
			id / 10000 == 109;//shield
			id / 10000 == 110;//cape
			*/
var text;
var selstatus = -1;
var itemList = new Array();
var inventoryType;
var deleteSlot;
var deleteQuantity;
var level;
importPackage(java.util);
importPackage(net.sf.odinms.client);
importPackage(net.sf.odinms.server);

function start() {
	status = -1;
	action(1, 0, 0);
}


function action(mode, type, selection) {
    if (mode <= 0) {
        cm.dispose();
        return;
    } else {
        if (mode == 1) {
            status++;
        } else {
            status--;
        }

        if (status == 0) {
            var text="你好冒险者，欢迎来到#b装备分解驿站，#k你要分解装备吗？"
            text += "#L0#分解装备#l\r\n";
            text += "\r\n\r\n\r\n\r\n";
            cm.sendSimple(text);
			
        } else {
            if (selstatus == -1) {
                selstatus = selection;
            }
            switch (selstatus) {
                case 0:
                    deleteItemBySlot(selection);
                    break;
                case 1:
                    cm.openNpc(cm.getNpc(), 501);
            }
        }
    }
}

function deleteItemBySlot(selection) {

    if (status == 1) {
        inventoryType = 1;
        itemList = cm.getInventory(inventoryType).list().iterator();
        text = "#e- 请选择你要分解的装备 -#n\r\n\r\n#b";
        var indexof = 1;
        while (itemList.hasNext()) {
            var item = itemList.next();
            text += "#L" + item.getPosition() + "##v" + item.getItemId() + "#";
            if (indexof > 1 && indexof % 5 == 0) {
                text += "\r\n";
            }
            indexof++;
        }
        cm.sendSimple(text);
    } else if (status == 2) {
        var item = cm.getInventory(inventoryType).getItem(selection);
        deleteSlot = selection;
        deleteQuantity = item.getQuantity();
		level=cm.getItemLevel(item.getItemId());
		//id=item.getItemId();
		text = "#e确认分解#v" + item.getItemId() + "##b#z" + item.getItemId() + "#?";
        cm.sendNextPrev(text);

    } else if (status == 3) {
		
		var random = new java.util.Random();
		var a = Math.floor((Math.random()*(level / 10)+2));//2-level / 10的随机整数
		var b = Math.floor((Math.random()*(level / 10)+2));//2-level / 10的随机整数
		var c = Math.floor((Math.random()*(level / 10)+2));//2-level / 10的随机整数
		
        if (level >= 31 && level <= 50) {

            var i = random.nextInt(ore_1.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_1[i],+2);
			cm.gainItem(crystal[0],+2);
			cm.gainItem(Magicpowder[k],+2);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
        } else if (level >= 51 && level <= 60) {
            
			var i = random.nextInt(ore_1.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_1[i],+a);
			cm.gainItem(crystal[1],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
			
        } else if (level >= 61 && level <= 70) {
            
			var i = random.nextInt(ore_1.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_1[i],+a);
			cm.gainItem(crystal[2],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
			
        } else if (level >= 71 && level <= 80) {
            
			var i = random.nextInt(ore_1.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_1[i],+a);
			cm.gainItem(crystal[3],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
        } else if (level >= 81 && level <= 90) {
            
			var i = random.nextInt(ore_1.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_1[i],+a);
			cm.gainItem(crystal[4],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
        } else if (level >= 91 && level <= 100) {
            
			var i = random.nextInt(ore_2.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_2[i],+a);
			cm.gainItem(crystal[5],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
			
        } else if (level >= 101 && level <= 110) {
            
			var i = random.nextInt(ore_2.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_2[i],+a);
			cm.gainItem(crystal[6],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
			
        } else if (level >= 111 && level <= 120) {
            
			var i = random.nextInt(ore_2.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_2[i],+a);
			cm.gainItem(crystal[7],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
			
        } else if (level >= 121 && level <= 200) {
            
			var i = random.nextInt(ore_2.length);
			var k = random.nextInt(Magicpowder.length);
			cm.removeSlot(inventoryType, deleteSlot, deleteQuantity);
			cm.gainItem(ore_2[i],+a);
			cm.gainItem(crystal[8],+b);
			cm.gainItem(Magicpowder[k],+c);
			cm.sendOk("恭喜你分解成功，祝你游戏愉快！");
			status = 0;
			cm.dispose();
			
			
        } else {
            cm.sendOk("你的装备等级不够31级，无法进行分解...");
			
        }
			
		cm.dispose();		
    //Math.random()       返回值是一个大于等于0，且小于1的随机数
    //Math.random()*N    返回值是一个大于等于0，且小于N的随机数
    //Math.floor()           向下取整，如Math.floor(0.3)=0、又如Math.floor(Math.random()*10)返回0~9
	//var x = Math.floor((Math.random()*10+5));//5-14的随机整数
	//var y = Math.floor(Math.random()*10);//0-9的随机整数


    }
}